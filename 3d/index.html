<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>A-Frame GLB with Camera and Lights</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
        <script src="https://unpkg.com/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>

  </head>
  <body>
    <a-scene>
      <!-- Load GLB model -->
      <a-entity id="model" gltf-model="url(violet.glb)" scale="1 1 1"></a-entity>

      <!-- Container for extracted camera -->
      <a-entity id="camera-container">
        <!-- Camera will be added here -->
      </a-entity>

      <!-- Container for extracted lights -->
      <a-entity id="lights-container">
        <!-- Lights will be added here -->
      </a-entity>

      <!-- Default camera as fallback -->
      <a-entity id="default-camera" camera="active: true;fov:10" position="-10 1.6 0" rotation="0 100 0"  look-controls wasd-controls></a-entity>
    </a-scene>

    <script>
      // Wait for the model to load
      const model = document.querySelector('#model');
      const cameraContainer = document.querySelector('#camera-container');
      const lightsContainer = document.querySelector('#lights-container');

      model.addEventListener('model-loaded', (e) => {
        const gltf = e.detail.model;
        const scene = gltf.scene || gltf.scenes[0];

        // Traverse the GLB scene to find cameras and lights
        scene.traverse((node) => {
          // Extract and add cameras
          if (node.isCamera) {
            const cameraEl = document.createElement('a-entity');
            cameraEl.setAttribute('camera', `active: ${node.isPerspectiveCamera}`);
            cameraEl.object3D.copy(node); // Copy camera properties
            cameraContainer.appendChild(cameraEl);

            // Optionally set this camera as active
            if (node.isPerspectiveCamera) {
              document.querySelector('#default-camera').setAttribute('camera', 'active', false);
              cameraEl.setAttribute('camera', 'active', true);
            }
          }

          // Extract and add lights
          if (node.isLight) {
            const lightEl = document.createElement('a-entity');
            lightEl.setAttribute('light', {
              type: node.type.toLowerCase().replace('light', ''), // e.g., 'DirectionalLight' -> 'directional'
              color: node.color.getHexString(),
              intensity: node.intensity,
              distance: node.distance,
              decay: node.decay,
            });
            lightEl.object3D.position.copy(node.position); // Copy light position
            lightEl.object3D.rotation.copy(node.rotation); // Copy light rotation
            lightsContainer.appendChild(lightEl);
          }
        });
        // Add look-at component after the model is loaded
  const defaultCamera = document.querySelector('#default-camera');
  defaultCamera.setAttribute('look-at', '#model');
      });
    </script>
  </body>
</html>
